var horas=["10:00","10:20","10:40","11:00","11:20","11:40","12:00","12:20","12:40","13:00","13:20","13:40","14:00","14:20","14:40","15:00","15:20","15:40","16:00","16:20","16:40","17:00","17:20","17:40","18:00","18:20","18:40","19:00","19:20","19:40","20:00","20:20","20:40","21:00","21:20","21:40"];var colores=["RGBA(187,60,40,1)","RGBA(13,139,105,1)","RGBA(21,124,239,1)","RGBA(156,60,221,1)","RGBA(187,106,62,1)","RGBA(241,171,68,1)","RGBA(110,233,176,1)","RGBA(254,114,133,1)","RGBA(5,54,151,1)","RGBA(132,166,177,1)","RGBA(205,31,138,1)","RGBA(150,150,150,1)"];var values=[];horas.forEach(function(e,i){values[i]=0;});var num_citas=null;var status_citas=null;var serv_citas=null;var num_citas_tiendas=null;var num_contacto=null;var form_contacto=null;var motivo_contacto=null;var optionLinear={scales:{yAxes:[{display:true,ticks:{suggestedMin:0,suggestedMax:6,}}]}};var optionPie={pieceLabel:{render:'percentage',fontColor:'#686868',position:'outside',precision:2}};(function($){$(document).ready(function(){if($('#estadisticas').size()>0){num_citas=new Chart($('#chart-area'),{type:'line',data:{labels:horas,datasets:[{label:'Total',data:values,backgroundColor:'rgba(0,0,0,0.02)',borderColor:'rgba(0,0,0,0.6)',borderWidth:1,tension:0,disabled:true,},{label:'V. Tienda',data:values,backgroundColor:'rgba(229,10,120,0.05)',borderColor:'rgba(229,10,120,0.8)',borderWidth:1,tension:0,hidden:true,},{hidden:true,label:'V. Online',data:values,backgroundColor:'rgba(0,178,254,0.05)',borderColor:'rgba(0,178,254,0.8)',borderWidth:1,tension:0,},{hidden:true,label:'V. Recuperable',data:values,backgroundColor:'rgba(115,57,223,0.05)',borderColor:'rgba(115,57,223,0.8)',borderWidth:1,tension:0,},{hidden:true,label:'Déposito',data:values,backgroundColor:'rgba(238,127,85,0.05)',borderColor:'rgba(238,127,85,0.8)',borderWidth:1,tension:0,}]},options:optionLinear});status_citas=new Chart($('#estado-citas'),{type:'pie',data:{labels:['Confirmadas','Conf. Compra','Canceladas','Ausentes','Pendientes'],datasets:[{data:[0,0,0,0,0],backgroundColor:['rgba(171,45,102,0.7)','rgba(140,37,84,0.9)','rgba(234,84,123,0.7)','rgba(234,84,123,0.4)','rgba(234,84,123,0.15)',]}]},options:optionPie});serv_citas=new Chart($('#servicio-citas'),{type:'pie',data:{labels:['V.Tienda','V.Online','V.Recuperable','Depósito'],datasets:[{data:[0,0,0],backgroundColor:['rgba(229,10,120,0.8)','rgba(0,178,254,0.8)','rgba(115,57,223,0.8)','rgba(238,127,85,0.8)']}]},options:optionPie});num_citas_tiendas=new Chart($('#chart-tiendas'),{type:'line',data:{labels:horas,datasets:[]},options:optionLinear});updateStatsCitas();$('.box-picker .datepicker').datepicker({language:'es',minDate:null,autoclose:true,orientation:'bottom',format:'yyyy-mm-dd'});$('#filter').on('click',function(e){e.preventDefault();updateStatsCitas();});$('#get-excel').on('click',function(e){e.preventDefault();getStatsExcelCitas();});}
$('select[name="periodo"]').on('change',function(e){if($(this).val()=='Personalizado'||$(this).val()=='custom'){$(this).parents('form').find('.box-rango').show();}else{$(this).parents('form').find('.box-rango').hide();}});$('.get-filter').on('click',function(e){e.preventDefault();updateStatistics($(this).data('stats'));});$('.get-excel').on('click',function(e){e.preventDefault();var s=$(this).data('stats');getStatisticsExcel(s);});});})(jQuery);function randomScalingFactor(){return Math.round(Math.random()*1);}
function getFilterValuesCitas(){var data={group:$('#estadisticas select[name="grupo"], #hidden-option').val(),ciudad:$('#estadisticas #stats-ciudades').val(),tienda:$('#estadisticas #stats-tiendas, #hidden-tienda').val(),option:$('#estadisticas select[name="periodo"]').val(),status:$('#estadisticas select[name="estado"]').val(),time:$('#estadisticas select[name="hora"]').val(),service:$('#estadisticas select[name="servicio"]').val()}
if(data.option=='custom'){data.start=$('#estadisticas input[name="start"]').val();data.end=$('#estadisticas input[name="end"]').val();}
return data;}
function updateStatsCitas(){$('#filter').addClass('btn-loading');var data=getFilterValuesCitas();if((data.option!='custom')||(data.option=='custom'&&data.start!=''&&data.end!='')){$.post(PLUGIN.uri+'/cita-previa/res/stats-citas.php',data,function(res){num_citas.data.labels=res.labels;num_citas.data.datasets[1].data=res.values.vtienda;num_citas.data.datasets[2].data=res.values.vonline;num_citas.data.datasets[3].data=res.values.vrecuperable;num_citas.data.datasets[4].data=res.values.deposito;num_citas.data.datasets[0].data=res.values.total;num_citas.update();if($('#stats-ciudades').size()>0){num_citas_tiendas.data.labels=res.labels;var cont=0;num_citas_tiendas.data.datasets=[];$.each(res.values.tiendas,function(){num_citas_tiendas.data.datasets[cont]={label:this.title,data:this.values,backgroundColor:'transparent',borderColor:colores[cont%12],borderWidth:1,tension:0,};cont++;});num_citas_tiendas.update();}
status_citas.data.datasets[0].data=[res.resume.confirmadas,res.resume.conf_venta,res.resume.canceladas,res.resume.ausentes,res.resume.pendientes];status_citas.update();serv_citas.data.datasets[0].data=[res.resume.ventatienda,res.resume.ventaonline,res.resume.ventarecuperable,res.resume.deposito,];serv_citas.update();$('#span-fecha').text(res.resume.fecha);$('#span-total').countTo({speed:600,from:this.val,to:res.resume.total});$('#span-confirmadas-venta').countTo({speed:500,from:this.val,to:res.resume.conf_venta});$('#span-confirmadas').countTo({speed:500,from:this.val,to:res.resume.confirmadas});$('#span-canceladas').countTo({speed:500,from:this.val,to:res.resume.canceladas});$('#span-ausentes').countTo({speed:500,from:this.val,to:res.resume.ausentes});$('#span-pendientes').countTo({speed:500,from:this.val,to:res.resume.pendientes});if($('#stats-ciudades').size()>0){if(data.ciudad=='all'&&$('#chart-tiendas').hasClass('is-admin')){$('#chart-tiendas').hide()}else{$('#chart-tiendas').show()}}
$('#filter').removeClass('btn-loading');});}}
function getColor(){return 'rgba('+Math.floor((Math.random()*255))+','+Math.floor((Math.random()*255))+','+Math.floor((Math.random()*255))+',.8';}
function getStatsExcelCitas(){var data=getFilterValuesCitas();if((data.option!='custom')||(data.option=='custom'&&data.start!=''&&data.end!='')){$.post(PLUGIN.uri+'/cita-previa/res/stats-excel.php',data,function(res){var $a=$("<a>").attr('href',res.file);$('body').append($a);$a.attr('download',res.name);$a[0].click();$a.remove();});}}
function updateStatistics(s){$('.get-filter').addClass('btn-loading');var data=$('#form-stats-'+s).serializeArray();$.post(PLUGIN.uri+'/users-area/res/get-statistics.php',data,function(res){window['linear_'+s].data.labels=res.labels;window['linear_'+s].data.datasets[0].data=res.values;window['linear_'+s].update();window['pie_uno_'+s].data.datasets[0].data=res.pies[0];window['pie_uno_'+s].update();window['pie_dos_'+s].data.datasets[0].data=res.pies[1];window['pie_dos_'+s].update();$('#span-fecha-'+s).text(res.resume.fecha);$('#span-total-'+s).countTo({speed:600,from:this.val,to:res.resume.total});$('.get-filter').removeClass('btn-loading');});}
function getStatisticsExcel(s){var data=$('#form-stats-'+s).serialize();$.post(PLUGIN.uri+'/users-area/res/get-excel.php',data,function(res){var $a=$("<a>").attr('href',res.file);$('body').append($a);$a.attr('download',res.name);$a[0].click();$a.remove();});}